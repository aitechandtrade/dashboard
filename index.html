<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        :root { 
            --bg: #000000; 
            --card-bg: #111111; 
            --border: #333; 
            --text-main: #ffffff;
            --text-muted: #888888;
            --accent: #3a86ff; /* Nice blue accent */
        }
        
        body { 
            background: var(--bg); color: var(--text-main); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 20px; height: 100vh; box-sizing: border-box;
            display: grid; 
            grid-template-columns: 350px 1fr; 
            grid-template-rows: 140px 140px 1fr; 
            gap: 20px;
        }

        .card { 
            background: var(--card-bg); 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            padding: 20px; 
            position: relative;
            display: flex; flex-direction: column;
        }

        /* 1. CLOCK (Top Left) */
        #clock-card { justify-content: center; align-items: center; }
        #clock { font-size: 3.5rem; font-weight: 700; letter-spacing: -2px; }
        #date { font-size: 1rem; color: var(--text-muted); margin-top: 5px; font-weight: 500; }

        /* 2. TIMER (Middle Left) */
        #timer-card { justify-content: center; align-items: center; }
        #timer-display { font-size: 3rem; font-weight: 700; font-variant-numeric: tabular-nums; }
        #timer-label { font-size: 0.8rem; letter-spacing: 2px; color: var(--text-muted); text-transform: uppercase; margin-top: 5px; }
        /* When timer is active, make it blue */
        .timer-active { color: var(--accent); }

        /* 3. TASKS (Bottom Left) */
        #notes-card { grid-row: 3 / 4; overflow-y: hidden; }
        .card-header { font-size: 0.8rem; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        #notes-list { overflow-y: auto; height: 100%; padding-right: 5px; }
        .note { 
            background: #1a1a1a; 
            padding: 12px; 
            border-radius: 8px; 
            margin-bottom: 8px; 
            font-size: 0.95rem; 
            border-left: 3px solid var(--accent);
            line-height: 1.4;
        }

        /* 4. CALENDAR (Right Side) */
        #calendar-card { grid-column: 2 / 3; grid-row: 1 / 4; padding: 0; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; filter: invert(0.92) hue-rotate(180deg) brightness(0.9) contrast(1.1); }

    </style>
</head>
<body>

    <div class="card" id="clock-card">
        <div id="clock">00:00</div>
        <div id="date">Loading...</div>
    </div>

    <div class="card" id="timer-card">
        <div id="timer-display">--:--</div>
        <div id="timer-label">No Active Timer</div>
    </div>

    <div class="card" id="notes-card">
        <div class="card-header">Priority Tasks</div>
        <div id="notes-list">
            </div>
    </div>

    <div class="card" id="calendar-card">
        <iframe src="https://calendar.google.com/calendar/embed?src=abdullahimtiazalishaikh%40gmail.com&ctz=Asia%2FDubai&showTitle=0&showNav=0&showDate=0&showPrint=0&showTabs=0&showCalendars=0"></iframe>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDC33-WXrZ50uHjjLlW9qhwT7REdSQ6M3s",
            authDomain: "mydashboard-13727.firebaseapp.com",
            databaseURL: "https://mydashboard-13727-default-rtdb.firebaseio.com",
            projectId: "mydashboard-13727",
            storageBucket: "mydashboard-13727.firebasestorage.app",
            messagingSenderId: "389525920980",
            appId: "1:389525920980:web:902256a3b7ca93b657ef41"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // CLOCK
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false});
            const options = { weekday: 'long', month: 'short', day: 'numeric' };
            document.getElementById('date').innerText = now.toLocaleDateString('en-US', options);
        }, 1000);

        // NOTES (Listens to DB changes automatically)
        onValue(ref(db, 'notes'), (snap) => {
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            if(snap.exists()) {
                // Convert object to array so we can reverse it (newest first)
                const notesArray = [];
                snap.forEach(child => {
                    notesArray.push(child.val());
                });
                
                notesArray.reverse().forEach(txt => {
                    const div = document.createElement('div');
                    div.className = 'note';
                    div.innerText = txt;
                    list.appendChild(div);
                });
            } else {
                list.innerHTML = '<div style="color: #444; text-align:center; margin-top: 20px;">All caught up.</div>';
            }
        });

        // TIMER
        let timerInt;
        onValue(ref(db, 'timer'), (snap) => {
            clearInterval(timerInt);
            const display = document.getElementById('timer-display');
            const label = document.getElementById('timer-label');
            
            if(snap.exists() && snap.val().endTime) {
                const data = snap.val();
                label.innerText = "TIME REMAINING";
                display.classList.add('timer-active');
                
                timerInt = setInterval(() => {
                    const diff = data.endTime - Date.now();
                    if(diff <= 0) {
                        clearInterval(timerInt);
                        display.innerText = "00:00";
                        display.classList.remove('timer-active');
                        display.style.color = "#06d6a0"; // Green when done
                        label.innerText = "SESSION COMPLETE";
                    } else {
                        const m = Math.floor(diff / 60000);
                        const s = Math.floor((diff % 60000) / 1000);
                        display.innerText = `${m}:${s<10?'0':''}${s}`;
                    }
                }, 1000);
            } else {
                display.innerText = "--:--";
                display.classList.remove('timer-active');
                display.style.color = "inherit";
                label.innerText = "IDLE";
            }
        });
    </script>
</body>
</html>
