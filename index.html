<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON HUD</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --neon-blue: #00f3ff;
            --neon-pink: #bc13fe;
            --glass: rgba(20, 20, 35, 0.7);
            --border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        body { 
            margin: 0; padding: 20px; height: 100vh; box-sizing: border-box;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #141e30);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white; font-family: 'Rajdhani', sans-serif;
            display: grid; 
            grid-template-columns: 360px 1fr; 
            grid-template-rows: 160px 140px 1fr; 
            gap: 20px;
        }

        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .hud-box { 
            background: var(--glass);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: var(--border);
            border-radius: 16px;
            padding: 20px;
            display: flex; flex-direction: column;
            position: relative; overflow: hidden;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        /* CLOCK */
        #clock-box { justify-content: center; align-items: center; border-left: 4px solid var(--neon-blue); }
        #clock { 
            font-family: 'Orbitron', sans-serif; font-size: 4rem; font-weight: 900; 
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.5); margin: 0; line-height: 1;
        }
        #date { font-size: 1.2rem; letter-spacing: 2px; color: var(--neon-blue); text-transform: uppercase; margin-top: 10px; }

        /* MEDIA */
        #media-box { border-left: 4px solid var(--neon-pink); justify-content: space-between; }
        .media-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .visualizer { display: flex; gap: 4px; align-items: flex-end; height: 50px; width: 100%; margin-top: 10px; opacity: 0.3; }
        .bar { width: 100%; background: var(--neon-pink); border-radius: 2px; height: 10%; }
        
        /* Active Visualizer Animation */
        .visualizer.active { opacity: 1; }
        .visualizer.active .bar { animation: bounce 1s infinite ease-in-out; box-shadow: 0 0 10px var(--neon-pink); }
        @keyframes bounce { 0%, 100% { height: 10%; } 50% { height: 100%; } }
        .bar:nth-child(1) { animation-duration: 0.8s; } .bar:nth-child(2) { animation-duration: 1.1s; } .bar:nth-child(3) { animation-duration: 0.9s; } 
        .bar:nth-child(4) { animation-duration: 1.3s; } .bar:nth-child(5) { animation-duration: 0.7s; }

        /* NOTES - Fixed Scrolling */
        #notes-box { grid-row: 3 / 4; border-top: 4px solid #fff; padding-right: 5px; }
        h3 { margin: 0 0 10px 0; font-family: 'Orbitron'; letter-spacing: 2px; font-size: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        
        #notes-scroll-area { 
            flex-grow: 1; 
            overflow-y: auto; /* Enable scrolling */
            padding-right: 5px; 
        }
        /* Custom Scrollbar */
        #notes-scroll-area::-webkit-scrollbar { width: 5px; }
        #notes-scroll-area::-webkit-scrollbar-thumb { background: #555; border-radius: 5px; }
        
        .note { 
            background: rgba(255,255,255,0.08); padding: 12px; border-radius: 8px; margin-bottom: 8px; 
            border-left: 2px solid var(--neon-blue); font-size: 1.1rem; line-height: 1.4;
            animation: slideIn 0.3s forwards;
        }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* CALENDAR */
        #calendar-box { grid-column: 2 / 3; grid-row: 1 / 4; padding: 0; border: none; background: transparent; }
        iframe { width: 100%; height: 100%; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); filter: invert(1) hue-rotate(180deg) contrast(0.9) brightness(0.9); }

        /* TIMER PILL */
        #timer-pill {
            position: absolute; top: 15px; right: 15px;
            background: var(--neon-pink); padding: 5px 15px;
            border-radius: 20px; font-weight: bold; font-family: 'Orbitron';
            box-shadow: 0 0 15px var(--neon-pink); display: none;
        }
    </style>
</head>
<body>

    <div class="hud-box" id="clock-box">
        <div id="timer-pill">00:00</div>
        <div id="clock">12:00</div>
        <div id="date">LOADING...</div>
    </div>

    <div class="hud-box" id="media-box">
        <div class="media-header">
            <span style="font-family:'Orbitron'; color:var(--neon-pink);">AUDIO FEED</span>
            <span id="media-state" style="font-size:0.8rem; letter-spacing:1px; color:#aaa;">STANDBY</span>
        </div>
        <div class="visualizer" id="viz">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
    </div>

    <div class="hud-box" id="notes-box">
        <h3>MISSION LOG</h3>
        <div id="notes-scroll-area">
            <div id="notes-list"></div>
        </div>
    </div>

    <div class="hud-box" id="calendar-box">
        <iframe src="https://calendar.google.com/calendar/embed?src=abdullahimtiazalishaikh%40gmail.com&ctz=Asia%2FDubai&showTitle=0&showNav=0&showDate=0&showPrint=0&showTabs=0&showCalendars=0"></iframe>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDC33-WXrZ50uHjjLlW9qhwT7REdSQ6M3s",
            authDomain: "mydashboard-13727.firebaseapp.com",
            databaseURL: "https://mydashboard-13727-default-rtdb.firebaseio.com",
            projectId: "mydashboard-13727",
            storageBucket: "mydashboard-13727.firebasestorage.app",
            messagingSenderId: "389525920980",
            appId: "1:389525920980:web:902256a3b7ca93b657ef41"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. Clock Logic
        setInterval(() => {
            const now = new Date();
            let h = now.getHours();
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12; h = h ? h : 12; 
            const m = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('clock').innerText = `${h}:${m} ${ampm}`;
            document.getElementById('date').innerText = now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
        }, 1000);

        // 2. Notes Sync (Loop Fix)
        onValue(ref(db, 'notes'), (snap) => {
            const list = document.getElementById('notes-list');
            list.innerHTML = ''; // Clear existing
            if(snap.exists()) {
                const notes = [];
                snap.forEach(child => notes.push(child.val())); // Collect all notes
                // Reverse to show newest at top
                notes.reverse().forEach(txt => {
                    const d = document.createElement('div');
                    d.className = 'note';
                    d.innerText = txt;
                    list.appendChild(d);
                });
            }
        });

        // 3. Media Sync
        const viz = document.getElementById('viz');
        const mState = document.getElementById('media-state');
        onValue(ref(db, 'media'), (snap) => {
            if(snap.exists()) {
                const action = snap.val().action;
                if (action === 'play') {
                    viz.classList.add('active');
                    mState.innerText = "PLAYING";
                    mState.style.color = "#fff";
                } else {
                    viz.classList.remove('active');
                    mState.innerText = "PAUSED";
                    mState.style.color = "#aaa";
                }
            }
        });

        // 4. Timer Sync
        let tInt;
        onValue(ref(db, 'timer'), (snap) => {
            clearInterval(tInt);
            const pill = document.getElementById('timer-pill');
            if(snap.exists() && snap.val().endTime) {
                const end = snap.val().endTime;
                pill.style.display = 'block';
                tInt = setInterval(() => {
                    const diff = end - Date.now();
                    if(diff <= 0) {
                        pill.innerText = "DONE";
                        pill.style.background = "#00ff41";
                    } else {
                        const m = Math.floor(diff/60000);
                        const s = Math.floor((diff%60000)/1000);
                        pill.innerText = `${m}:${s<10?'0':''}${s}`;
                    }
                }, 1000);
            } else { pill.style.display = 'none'; }
        });
    </script>
</body>
</html>
