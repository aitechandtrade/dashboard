<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM HOST</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0a0a0a; color: #e0e0e0; font-family: 'Segoe UI', monospace; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 600px; width: 100%; display: flex; flex-direction: column; gap: 20px; }
        
        .panel { 
            background: #161b22; padding: 25px; border-radius: 12px; 
            border: 1px solid #30363d; box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
        }
        
        h3 { margin-top: 0; color: #8b949e; display: flex; align-items: center; gap: 10px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #30363d; padding-bottom: 10px;}
        
        /* Form Elements */
        label { display: block; margin-top: 10px; font-size: 0.8rem; color: #8b949e; }
        input, select { width: 100%; box-sizing: border-box; padding: 12px; margin-top: 5px; background: #0d1117; color: #58a6ff; border: 1px solid #30363d; border-radius: 6px; font-family: monospace; }
        
        button { 
            padding: 12px; width: 100%; cursor: pointer; border: none; border-radius: 6px; margin-top: 10px;
            font-weight: bold; background: #238636; color: white; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 1rem;
        }
        button:hover { background: #2ea043; }
        
        /* Color Picker */
        .color-options { display: flex; gap: 10px; margin-top: 10px; }
        .color-opt { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .color-opt.active { border-color: white; transform: scale(1.1); }

        .note-item { 
            display: flex; justify-content: space-between; align-items: center;
            background: #0d1117; padding: 12px; border: 1px solid #30363d; border-radius: 6px;
            margin-bottom: 8px; font-size: 0.9rem; color: #c9d1d9;
        }
        .del-btn { color: #da3633; cursor: pointer; padding: 5px; }
        
        #toast { position: fixed; bottom: 20px; right: 20px; background: #238636; color: white; padding: 10px 20px; border-radius: 6px; opacity: 0; transition: 0.3s; }
        #toast.show { opacity: 1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h3><i class="fab fa-youtube"></i> Audio Source</h3>
            <input type="text" id="yt-url" placeholder="Paste YouTube Link or Playlist">
            <button onclick="loadUserLink()" style="background: #1f6feb"><i class="fas fa-satellite-dish"></i> LOAD LINK</button>
            <div id="player" style="margin-top: 15px; height: 100px; width: 100%; border-radius: 6px; overflow: hidden;"></div>
        </div>

        <div class="panel">
            <h3><i class="fas fa-sliders-h"></i> Dashboard Settings</h3>
            <label>Page Title</label>
            <input type="text" id="page-title" placeholder="NEON HUD">
            
            <label>Notes Title</label>
            <input type="text" id="notes-title" placeholder="MISSION LOG">
            
            <label>Theme</label>
            <select id="theme-select">
                <option value="default">Original (Blue/Purple)</option>
                <option value="matrix">Matrix (Green)</option>
                <option value="cyberpunk">Cyberpunk (Yellow/Pink)</option>
                <option value="red">Red Alert</option>
            </select>
            
            <label>Accent Color</label>
            <div class="color-options">
                <div class="color-opt" style="background: #00f3ff" onclick="pickColor('#00f3ff', this)"></div>
                <div class="color-opt" style="background: #00ff41" onclick="pickColor('#00ff41', this)"></div>
                <div class="color-opt" style="background: #ffee00" onclick="pickColor('#ffee00', this)"></div>
                <div class="color-opt" style="background: #ff0055" onclick="pickColor('#ff0055', this)"></div>
            </div>

            <label>Calendar URL (Google Embed Link)</label>
            <input type="text" id="calendar-url" placeholder="https://calendar.google.com...">

            <button onclick="saveSettings()"><i class="fas fa-save"></i> SAVE SETTINGS</button>
        </div>

        <div class="panel">
            <h3><i class="fas fa-tasks"></i> Mission Log</h3>
            <input type="text" id="noteIn" placeholder="New Objective...">
            <button onclick="addNote()"><i class="fas fa-plus"></i> ADD TASK</button>
            <div id="active-notes" style="margin-top: 20px; border-top: 1px solid #30363d; padding-top: 15px;"></div>
        </div>
    </div>

    <div id="toast">Settings Saved!</div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, set, push, remove, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDC33-WXrZ50uHjjLlW9qhwT7REdSQ6M3s",
            authDomain: "mydashboard-13727.firebaseapp.com",
            databaseURL: "https://mydashboard-13727-default-rtdb.firebaseio.com",
            projectId: "mydashboard-13727",
            storageBucket: "mydashboard-13727.firebasestorage.app",
            messagingSenderId: "389525920980",
            appId: "1:389525920980:web:902256a3b7ca93b657ef41"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let selectedColor = '#00f3ff';

        // --- YOUTUBE ---
        window.player = null;
        window.onYouTubeIframeAPIReady = function() {
            window.player = new YT.Player('player', { height: '100%', width: '100%', playerVars: { 'playsinline': 1 } });
        }
        window.loadUserLink = () => {
            const url = document.getElementById('yt-url').value;
            if(url.includes('list=')) window.player.loadPlaylist({list:url.split('list=')[1].split('&')[0], listType:'playlist'});
            else if(url.includes('v=')) window.player.loadVideoById(url.split('v=')[1].split('&')[0]);
        }
        onValue(ref(db, 'media'), (snap) => {
            if(snap.exists() && window.player && window.player.playVideo) {
                const action = snap.val().action;
                const cmdTime = snap.val().timestamp;
                if (Date.now() - cmdTime < 2000) {
                    if (action === 'pause') window.player.pauseVideo();
                    if (action === 'play') window.player.playVideo();
                }
            }
        });

        // --- TASKS ---
        window.addNote = () => {
            const val = document.getElementById('noteIn').value;
            if(val) { push(ref(db, 'notes'), { text: val, created: Date.now() }); document.getElementById('noteIn').value = ''; }
        }
        onValue(ref(db, 'notes'), (snap) => {
            const list = document.getElementById('active-notes'); list.innerHTML = '';
            if(snap.exists()) {
                snap.forEach(child => {
                    const data = child.val();
                    const text = typeof data === 'object' ? data.text : data;
                    const div = document.createElement('div'); div.className = 'note-item';
                    div.innerHTML = `<span>${text}</span> <i class="fas fa-times del-btn" onclick="del('${child.key}')"></i>`;
                    list.appendChild(div);
                });
            } else { list.innerHTML = '<div style="text-align:center; color:#555;">No active tasks</div>'; }
        });
        window.del = (key) => remove(ref(db, 'notes/' + key));

        // --- SETTINGS ---
        window.pickColor = (c, el) => {
            selectedColor = c;
            document.querySelectorAll('.color-opt').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
        }
        window.saveSettings = () => {
            set(ref(db, 'settings'), {
                pageTitle: document.getElementById('page-title').value,
                notesTitle: document.getElementById('notes-title').value,
                calendarUrl: document.getElementById('calendar-url').value,
                theme: document.getElementById('theme-select').value,
                accentColor: selectedColor
            });
            document.getElementById('toast').classList.add('show');
            setTimeout(() => document.getElementById('toast').classList.remove('show'), 2000);
        }
        // Load settings on start
        onValue(ref(db, 'settings'), (snap) => {
            if(snap.exists()) {
                const s = snap.val();
                if(s.pageTitle) document.getElementById('page-title').value = s.pageTitle;
                if(s.notesTitle) document.getElementById('notes-title').value = s.notesTitle;
                if(s.calendarUrl) document.getElementById('calendar-url').value = s.calendarUrl;
                if(s.theme) document.getElementById('theme-select').value = s.theme;
            }
        });
    </script>
</body>
</html>
