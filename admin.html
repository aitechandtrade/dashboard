<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CMD CENTER</title>
    <style>
        body { 
            background: #0f0f11; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            display: flex; flex-direction: column; align-items: center; padding: 20px; 
        }
        h2 { color: #fff; letter-spacing: 1px; margin-bottom: 20px; }
        
        .panel { 
            background: #1e1e24; width: 100%; max-width: 400px; 
            padding: 20px; border-radius: 12px; margin-bottom: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); border: 1px solid #333;
        }
        
        h3 { margin-top: 0; color: #888; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1.5px; }

        /* Timer Controls */
        .timer-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input[type="number"] { width: 60px; padding: 10px; background: #111; border: 1px solid #444; color: white; border-radius: 6px; text-align: center; }
        
        button { border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-blue { background: #3a86ff; color: white; flex: 1; }
        .btn-blue:hover { background: #2667cc; }
        .btn-red { background: #ef233c; color: white; width: 100%; }
        .btn-red:hover { background: #d90429; }

        /* Note Controls */
        input[type="text"] { width: 100%; padding: 12px; background: #111; border: 1px solid #444; color: white; border-radius: 6px; box-sizing: border-box; margin-bottom: 10px; }
        .btn-green { background: #06d6a0; color: #000; width: 100%; }

        /* Active Notes List */
        #active-notes { margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; }
        .note-item { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #111; padding: 10px; border-radius: 6px; margin-bottom: 8px; font-size: 0.9rem;
        }
        .delete-btn { background: #333; color: #ff4444; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; margin-left: 10px; }
    </style>
</head>
<body>

    <h2>CONTROLLER</h2>

    <div class="panel">
        <h3>Timer</h3>
        <div class="timer-row">
            <input type="number" id="customTime" placeholder="Min" value="45">
            <button class="btn-blue" onclick="setCustomTimer()">START</button>
        </div>
        <div class="timer-row">
            <button class="btn-blue" style="background: #2b2d42;" onclick="setTimer(25)">25m</button>
            <button class="btn-blue" style="background: #2b2d42;" onclick="setTimer(5)">5m</button>
        </div>
        <button class="btn-red" onclick="stopTimer()">STOP / RESET</button>
    </div>

    <div class="panel">
        <h3>Tasks</h3>
        <input type="text" id="noteInput" placeholder="New task...">
        <button class="btn-green" onclick="addNote()">ADD TASK</button>

        <div id="active-notes">
            <div style="text-align:center; color: #555; font-size: 0.8rem;">Loading tasks...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, set, push, remove, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDC33-WXrZ50uHjjLlW9qhwT7REdSQ6M3s",
            authDomain: "mydashboard-13727.firebaseapp.com",
            databaseURL: "https://mydashboard-13727-default-rtdb.firebaseio.com",
            projectId: "mydashboard-13727",
            storageBucket: "mydashboard-13727.firebasestorage.app",
            messagingSenderId: "389525920980",
            appId: "1:389525920980:web:902256a3b7ca93b657ef41"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- Timer Functions ---
        window.setCustomTimer = () => {
            const mins = document.getElementById('customTime').value;
            if(mins) setTimer(mins);
        };
        
        window.setTimer = (mins) => {
            const endTime = Date.now() + (mins * 60000);
            set(ref(db, 'timer'), { endTime: endTime, label: 'FOCUS MODE' });
        };
        
        window.stopTimer = () => set(ref(db, 'timer'), null);

        // --- Note Functions ---
        window.addNote = () => {
            const input = document.getElementById('noteInput');
            if(input.value) {
                push(ref(db, 'notes'), input.value);
                input.value = '';
            }
        };

        // Listen to notes so we can delete them individually
        onValue(ref(db, 'notes'), (snapshot) => {
            const list = document.getElementById('active-notes');
            list.innerHTML = '';
            
            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const id = childSnapshot.key;
                    const text = childSnapshot.val();

                    const item = document.createElement('div');
                    item.className = 'note-item';
                    item.innerHTML = `
                        <span>${text}</span>
                        <button class="delete-btn" onclick="deleteNote('${id}')">âœ•</button>
                    `;
                    list.appendChild(item);
                });
            } else {
                list.innerHTML = '<div style="text-align:center; color: #555; padding:10px;">No active tasks</div>';
            }
        });

        window.deleteNote = (id) => {
            remove(ref(db, 'notes/' + id));
        };
    </script>
</body>
</html>
